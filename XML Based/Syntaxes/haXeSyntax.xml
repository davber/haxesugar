<?xml version="1.0"?>
<syntax name="com.davber.haxe">
	<zones>		
		<!-- Top-level stuff -->
	
			<!-- Package -->
			<zone name="declaration.package">
				<expression>\b(package)\s+([a-zA-Z_]\w*(?:\.[a-zA-Z_]\w*)*)</expression>
				<capture number="1" name="keyword.package" />
				<capture number="2" name="name.package" />
			</zone>
			<!-- Import -->
			<zone name="declaration.import">
				<expression>\b(import)\s+((?:[a-zA-Z_]\w*\.)*)([a-zA-Z_]\w*)</expression>
				<capture number="1" name="keyword.import" />
				<capture number="2" name="name.package" />
				<capture number="3" name="name.type" />
			</zone>
		
			<!-- Class -->
			<zone name="declaration.class">
					<expression>\b(class)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.type.class" />
					<capture number="2" name="name.type.class" />	
			</zone>
			
			<!-- Interface -->
			<zone name="declaration.interface">
					<expression>\b(class)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.type.interface" />
					<capture number="2" name="name.type.interface" />	
			</zone>
			
			<!-- Typedef -->
			<zone name="declaration.typedef">
				<expression>\b(typedef)\s+([a-zA-Z_]\w*)\s*\=\s*(.+)</expression>
				<capture number="1" name="keyword.type.typedef" />
				<capture number="2" name="name.type.typedef" />
				<capture number="3" name="name.type" />
			</zone>
			
			<!-- TODO : we should only include the core language inside an interface and class declaration -->
			
			<include collection="core" />
	</zones>
	
	<library>
		<collection name="core">
			<include collection="class.attributes" />
			<include collection="code.block" />
			<include collection="keyword" />
			<include collection="delimiter" />
			<include collection="literal.string" />
			<include collection="literal.numeric" />
			<include collection="literal.keyword" />
			<include collection="literal.collection" />
			<include collection="metadata.comment" />
		</collection>
		
		<!-- Class attributes - variables and methods -->
		<collection name="class.attributes">
			<zone name="declaration.method">
				<starts-with>
					<expression>\b(function)\s+([a-zA-Z_]\w*)\s*(\()</expression>
					<capture number="1" name="keyword.function" />
					<capture number="2" name="name.var.attribute" />
					<capture number="3" name="delimiter.balanced.parenthesis.condition.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\))</expression>
					<capture number="1" name="delimiter.balanced.parenthesis.condition.end"/>
				</ends-with>
				<subzones>
					<include collection="code.block.subzones" />
				</subzones>
			</zone>
			<zone name="declaration.var">
				<starts-with>
					<expression>\b(var)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.var" />
					<capture number="2" name="name.var.attribute" />
				</starts-with>
				<ends-with>
					<expression>(\))</expression>
					<capture number="1" name="delimiter.balanced.parenthesis.condition.end"/>
				</ends-with>
				<subzones>
					<include collection="code.block.subzones" />
				</subzones>
			</zone>
		</collection>

		<collection name="code.block">
            <zone name="code.block.if">
                <starts-with>
                    <expression>\b(if)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.if" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.begin.parenthesis" />
                </ends-with>
                <subzones>
                    <include collection="block.subzones" />
                </subzones>
            </zone>
            <zone name="code.block.elseif">
                <starts-with>
                    <expression>\b(else\s*if)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.elseif" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.end.parenthesis" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="code.block.else">
                <expression>\b(else)\b</expression>
                <capture number="1" name="keyword.control.else" />
                <capture number="2" name="delimiter.balanced.begin.parenthesis" />
            </zone>
            <zone name="code.block.for">
                <starts-with>
                    <expression>\b(for)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.for" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.end.parenthesis" />
                </ends-with>
                <subzones>
										<zone name="keyword.control.in">
                        <expression>in</expression>
                    </zone>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="code.block.while">
                <starts-with>
                    <expression>\b(while)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.while" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.end.parenthesis." />
                </ends-with>
                <subzones>
                    <include collection="container.block.subzones.haxe" />
                </subzones>
            </zone>
            <zone name="code.block.dowhile">
                    <expression>\b(do)</expression>
                    <capture number="1" name="keyword.control.dowhile" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
            </zone>
            <zone name="code.block.switch">
                <starts-with>
                    <expression>\b(switch)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.switch" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.end.parenthesis" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="code.block.try">
                <expression>\b(try)\b</expression>
                <capture number="1" name="keyword.control.try" />
            </zone>
            <zone name="code.block.catch">
                <starts-with>
                    <expression>\b(catch)\b\s*(\()</expression>
                    <capture number="1" name="keyword.control.catch" />
                    <capture number="2" name="delimiter.balanced.begin.parenthesis" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.end.parenthesis" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
        </collection>
		
		<collection name="code.block.subzones">
				<include collection="metadata.comment" />
	        <include collection="literal.collection" />
	        <include collection="container.block" />
	        <include collection="literal.keyword" />
	        <include collection="identifier.function" />
	        <include collection="delimiter" />
	        <include collection="operator" />
	        <include collection="identifier.variable" />
	        <include collection="identifier.class" />
	        <include collection="literal.string" />
	        <include collection="literal.numeric" />
	        <include collection="keyword" />
		</collection>
		
		<!-- Delimiters (grabbed from elliottcable's Ruby.sugar via the AS3 sugar...) -->
        
        <collection name="delimiter">
            <zone name="delimiter.terminator">
                <expression>;</expression>
            </zone>
            <zone name="delimiter.separator.comma">
                <expression>,</expression>
            </zone>
            <zone name="delimiter.separator.pairing">
                <expression>:</expression>
            </zone>
            <zone name="delimiter.balanced.begin.curly-brace">
                <expression>{</expression>
            </zone>
            <zone name="delimiter.balanced.end.curly-brace">
                <expression>}</expression>
            </zone>
            <zone name="delimiter.balanced.begin.parenthesis">
                <expression>\(</expression>
            </zone>
            <zone name="delimiter.balanced.end.parenthesis">
                <expression>\)</expression>
            </zone>
            <zone name="delimiter.balanced.begin.square-brace">
                <expression>\[</expression>
            </zone>
            <zone name="delimiter.balanced.end.square-brace">
                <expression>\]</expression>
            </zone>
        </collection>
		
		<collection name="comment">
			<zone name="comment.block.documentation">
				<starts-with>
					<expression>/\*\*</expression>
					<capture number="0" name="punctuation.definition.begin"/>
				</starts-with>
				<ends-with>
					<expression>\*/</expression>
					<capture number="0" name="punctuation.definition.end"/>
				</ends-with>
			</zone>
			<zone name="comment.block">
				<starts-with>
					<expression>/\*</expression>
					<capture number="0" name="punctuation.definition.begin"/>
				</starts-with>
				<ends-with>
					<expression>\*/</expression>
					<capture number="0" name="punctuation.definition.end"/>
				</ends-with>
			</zone>
			<zone name="comment.line.double-slash">
				<expression>(//).*$\n?</expression>
				<capture number="1" name="punctuation.definition.begin"/>
			</zone>
		</collection>
		
		<!-- Keywords and standard classes... -->
		
		<collection name="keyword">
			<zone name="keyword.definition">
				<expression>\b(package|class|function|import|interface|extends|implements|var|typedef)</expression>
			</zone>
			<zone name="name.sys.package.flash">
				<expression>\b(flash(?:\.(?:accessibility|display|errors|events|external|filters|geom|media|net|printing|sampler|system|text|trace|ui|utils|xml))?)\b</expression>
			</zone>
			<zone name="name.sys.package.haxe">
				<expression>\b(haxe(?:\.(?:io|remoting|rtti|unit|xml))?)\b</expression>
			</zone>
			<zone name="name.sys.package.js">
				<expression>\b(js)\b</expression>
			</zone>
			<zone name="name.sys.package.neko">
				<expression>\b(neko(?:\.(?:db|io|net|vm|zip))?)\b</expression>
			</zone>
			<zone name="name.sys.package.php">
				<expression>\b(php(?:\.(?:db|io|net))?)\b</expression>
			</zone>
			<zone name="name.sys.package.tools">
				<expression>\b(tools(?:\.(?:haxedoc|haxelib|hxinst))?)</expression>
			</zone>
			<zone name="name.sys.type.top">
				<expression>\b(Array(Access)?|Bool|Class|Date(Tools)?|Dynamic|EReg|Enum|Float|Hash|Int(Hash|Iter)?|Itera(ble|tor)|Lambda|List|Math|Null|Reflect|Std|String(Buf|Tools)?|Type|UInt|ValueType|Void|Xml(Type)?)\b</expression>
			</zone>
			<zone name="name.sys.type.flash">
				<expression>\b(Accessibility|Boot|Button|Camera|Color|ContextMenu(Item)?|ExtendedKey|Key|Lib|LoadVars|LocalConnection|Microphone|Mouse|MovieClip(Loader)?|Net(Connection|Stream)|PrintJob|Selection(Listener)?|SharedObject|Sound|Stage|System|Text(Field|Format|Snapshot)|Video|XML(Request|Socket))\b</expression>
			</zone>
			<zone name="name.sys.type.flash9">
				<expression>\b(Boot|Error|Lib|Memory|Vector)\b</expression>
			</zone>
			<zone name="name.sys.type.haxe">
				<expression>\b(BaseCode|Fast(Cell|List)|Firebug|Http|Int32|Log|Md5|PosInfos|Public|Resource|Serializer|Stack(Item)?|Template|Timer(Queue)?|TypeResolver|Unserializer)\b</expression>
			</zone>
			<zone name="name.sys.type.js">
				<expression>\b(Anchor|Body|Boot|Button|Checkbox|Document|Dom|Event|FileUpload|Form(Element)?|Frame(set)?|Hidden|History|Html(Collection|Dom)|IFrame|Image|Lib|Link|Location|MetaDom|Navigator|Option|Password|Radio|Reset|SWFObject|Screen|Select(ion)?|Style(Sheet)?|Submit|Text(area)?|Window|XML(HttpRequest|Socket))\b</expression>
			</zone>
			<zone name="name.sys.neko">
				<expression>\b(Boot|File(Kind|Stat|System)|Lib|Native(Array|String)|Random|Sys|Utf8|Web)\b</expression>
			</zone>
			<zone name="name.sys.php">
				<expression>\b(Boot|CacheLimiter|Exception|File(Kind|Stat|System)|HException|Lib|Native(Array|String)|Session|Sys|Utf8|Web)\b</expression>
			</zone>
			<zone name="keyword.control">
                <expression>\b(break|case|continue|default|do|else|else\s*if|for|if|switch|while|return)\b</expression>
            </zone>
			<zone name="keyword.modifier.scope">
				<expression>\b(public|private|protected|static|dynamic|override|inline)\b</expression>
			</zone>
		</collection>
		
		<!-- Literals Grabbed from PHP.sugar (via the AS3 sugar...) -->
	    
	    <collection name="literal.string">
            <zone name="literal.string.quoted.single">
                <starts-with>
                    <expression>'</expression>
                    <capture number="0" name="delimiter.balanced.begin.quote"/>
                </starts-with>
                <ends-with>
                    <expression>'</expression>
                    <capture number="0" name="delimiter.balanced.end.quote"/>
                </ends-with>
                <subzones>
                    <zone name="literal.escape.brief">
                        <!-- 'A single-quoted string with \'escape sequences\'' -->
                        <expression>(\\)('|\\)</expression>
                        <capture number="1" name="delimiter.seperator.escape"/>
                        <capture number="2" name="character"/>
                    </zone>
                </subzones>
            </zone>
            <zone name="literal.string.quoted.double">
                <starts-with>
                    <expression>"</expression>
                    <capture number="0" name="delimiter.balanced.begin.double-quote"/>
                </starts-with>
                <ends-with>
                    <expression>"</expression>
                    <capture number="0" name="delimiter.balanced.end.double-quote"/>
                </ends-with>
                <subzones>
                    <include collection="identifier.variable" />
                    <zone name="literal.escape.brief">
                        <!-- 'A single-quoted string with \'escape sequences\'' -->
                        <expression>(\\)("|\\)</expression>
                        <capture number="1" name="delimiter.seperator.escape"/>
                        <capture number="2" name="character"/>
                    </zone>
                </subzones>
            </zone>
	    </collection>
	    
        <collection name="literal.numeric">
            <!--
            I want to seperately hilight all the different types of
            literal.numerics. So, we have to provide multiple similar definitions
            of a literal.numeric.
            
			Grabbed from PHP Sugar
            Grabbed from elliottcable's Ruby.sugar
            -->
            <!-- 01756 -->
            <zone name="literal.numeric.integer.octal">
                <expression>\b(0)([0-7]+)\b</expression>
                <capture number="1" name="numeric.delimiter.octal.initial-zero"/>
                <capture number="2" name="numeric.octal.value"/>
            </zone>
            <!-- 0b010010110 -->
            <zone name="literal.numeric.integer.binary">
                <expression>\b(0(?:b|B))([01]+)\b</expression>
                <capture number="1" name="numeric.delimiter.binary.initial-zero-b"/>
                <capture number="2" name="numeric.binary.value"/>
            </zone>
            <!-- 0xDEADBEEF586 -->
            <zone name="literal.numeric.integer.hex">
                <expression>\b(0(?:x|X))([0-9a-fA-F]+)\b</expression>
                <capture number="1" name="numeric.delimiter.hexadecimal.initial-zero-x"/>
                <capture number="2" name="numeric.hexadecimal.value"/>
            </zone>
            <!-- 142.87e3, 0.22e8 -->
            <zone name="literal.numeric.float.with-exponent">
                <expression>\b(0|[1-9][0-9]*)(\.)([0-9]+)(e|E)(-?[0-9]+)\b</expression>
                <capture number="1" name="integral.value"/>
                <capture number="2" name="delimiter.seperator.radix-point"/>
                <capture number="3" name="fractional.value"/>
                <capture number="4" name="literal.numeric.exponent.delimiter"/>
                <capture number="5" name="literal.numeric.exponent.value"/>
            </zone>
            <!-- 142.87, 0.22 -->
            <zone name="literal.numeric.float">
                <expression>\b(0|[1-9][0-9]*)(\.)([0-9]+)\b</expression>
                <capture number="1" name="integral.value"/>
                <capture number="2" name="delimiter.seperator.radix-point"/>
                <capture number="3" name="fractional.value"/>
            </zone>
            <!-- 142e3, 0e8 -->
            <zone name="literal.numeric.integer.decimal.with-exponent">
                <expression>\b(0|[1-9][0-9]*)(e|E)(-?[0-9]+)\b</expression>
                <capture number="1" name="integral.value"/>
                <capture number="2" name="literal.numeric.exponent.delimiter"/>
                <capture number="3" name="literal.numeric.exponent.value"/>
            </zone>
            <!-- 142e3, 0e8 -->
            <zone name="literal.numeric.integer.decimal">
                <expression>\b(0|[1-9][0-9]*)\b</expression>
                <capture number="1" name="integral.value"/>
            </zone>
        </collection>
        
        <collection name="literal.keyword">
            <!-- true -->
            <zone name="literal.keyword.bool.true">
            	<expression>\btrue\b</expression>
            </zone>
            <!-- false -->
            <zone name="literal.keyword.bool.false">
            	<expression>\bfalse\b</expression>
            </zone>
            <!-- null -->
            <zone name="literal.keyword.null">
            	<expression>\bnull\b</expression>
            </zone>
						<!-- trace.. TODO : does not belong here -->
            <zone name="keyword.trace">
            	<expression>\btrace\b</expression>
            </zone>
        </collection>

		<!-- Metadata grabbed from PHP.sugar, but modified to handle #ifdef's -->
		<collection name="metadata.comment">
			<!-- // comment -->
			<zone name="metadata.comment.line.double-slash">
				<expression>(//)(\s?(.*)?$\n?)</expression>
				<capture number="1" name="delimiter.separator.double-slash.comment.begin" />
				<capture number="3" name="content" />
			</zone>
			
			<zone name="metadata.comment.documentation">
				<starts-with>
					<expression>(/\*\*)(\**)</expression>
					<capture number="1" name="delimiter.separator.slash.double-asterisk.comment.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\**)(\*/)</expression>
					<capture number="2" name="delimiter.separator.slash.single-asterisk.comment.end"/>
				</ends-with>
				<subzones>
					<zone name="comment.line">
						<starts-with>
							<expression>(\*)</expression>
							<capture number="1" name="delimiter.separator.asterisk" />
						</starts-with>
						<ends-with>
							<expression>$\n?</expression>
						</ends-with>
						<subzones>
							<zone name="content">
								<expression>(.*)?</expression>
								<capture number="3" name="content" />
							</zone>
						</subzones>
					</zone>
				</subzones>
			</zone>			

			<zone name="metadata.comment.block">
				<starts-with>
					<expression>(/\*)</expression>
					<capture number="1" name="delimiter.separator.slash.single-asterisk.comment.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\*/)</expression>
					<capture number="1" name="delimiter.separator.slash.single-asterisk.comment.end"/>
				</ends-with>
			</zone>
			
			<zone name="metadata.cond.if">
				<expression>(#(:else)?if)\s+([^\s]+)</expression>
				<capture number="1" name="keyword.preprocess.if" />
				<capture number="2" name="preprocess.cond" />
			</zone>
			
			<zone name="metadata.cond.else">
				<expression>(#else)</expression>
				<capture number="1" name="keyword.preprocess.else" />
			</zone>
			
			<zone name="metadata.cond.end">
				<expression>(#end)</expression>
				<capture number="1" name="keyword.preprocess.end" />
			</zone>
			
	    </collection>
		
	</library>
</syntax>