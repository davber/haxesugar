<?xml version="1.0"?>
<syntax name="com.davber.haxe">
	<zones>		
		<!-- Top-level stuff -->
	
			<!-- Package -->
			<zone name="container.package">
				<expression>\b(package)\s+([a-zA-Z_]\w*(?:\.[a-zA-Z_]\w*)*)</expression>
				<capture number="1" name="keyword.package" />
				<capture number="2" name="identifier.package.definition" />
			</zone>
			<!-- Import -->
			<zone name="container.import">
				<expression>\b(import)\s+((?:[a-zA-Z_]\w*\.)*)([a-zA-Z_]\w*)</expression>
				<capture number="1" name="keyword.import" />
				<capture number="2" name="identifier.package" />
				<capture number="3" name="identifier.type" />
			</zone>
		
			<!-- Class -->
			<zone name="container.class.definition">
					<expression>\b(class)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.definition.class" />
					<capture number="2" name="identifier.type.class.definition" />	
			</zone>
			
			<!-- Interface -->
			<zone name="container.class.interface.definition">
					<expression>\b(interface)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.definition.interface" />
					<capture number="2" name="identifier.type.interface.definition" />	
			</zone>
			
			<!-- Typedef -->
			<zone name="container.class.typedef.definition">
				<expression>\b(typedef)\s+([a-zA-Z_]\w*)</expression>
				<capture number="1" name="keyword.definition.typedef" />
				<capture number="2" name="identifier.type.typedef.definition" />
			</zone>
			
			<!-- TODO : we should only include the core language inside an interface and class declaration -->
			
			<include collection="core" />
	</zones>
	
	<library>
		<collection name="core">
			<include collection="class.attributes" />
			<include collection="code.block" />
			<include collection="metadata.comment" />
			<include collection="metadata.preprocess" />
			<include collection="keyword" />
			<include collection="delimiter" />
			<include collection="literal.string" />
			<include collection="literal.numeric" />
			<include collection="literal.keyword" />
			<include collection="literal.collection" />
		</collection>
		
		<!-- Class attributes - variables and methods -->
		<collection name="class.attributes">
			<zone name="container.function.definition.instance">
				<starts-with>
					<expression>\b(function)\s+([a-zA-Z_]\w*)\s*(\()</expression>
					<capture number="1" name="keyword.definition.function.instance" />
					<capture number="2" name="identifier.variable.function.definition.instance" />
					<capture number="3" name="delimiter.balanced.parenthesis.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\))</expression>
					<capture number="1" name="delimiter.balanced.parenthesis.end"/>
				</ends-with>
				<subzones>
					<include collection="code.block.subzones" />
				</subzones>
			</zone>
			<zone name="container.variable.definition.instance">
				<starts-with>
					<expression>\b(var)\s+([a-zA-Z_]\w*)</expression>
					<capture number="1" name="keyword.definition.variable.instance" />
					<capture number="2" name="identifier.variable.definition.instance" />
				</starts-with>
				<ends-with>
					<expression>(\))</expression>
					<capture number="1" name="delimiter.balanced.parenthesis.end"/>
				</ends-with>
				<subzones>
					<include collection="code.block.subzones" />
				</subzones>
			</zone>
		</collection>

		<collection name="code.block">
            <zone name="container.statement.control.flow.if">
                <starts-with>
                    <expression>\b(if)\s*(\()</expression>
                    <capture number="1" name="keyword.control.flow.if" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
                    <include collection="block.subzones" />
                </subzones>
            </zone>
            <zone name="container.statement.control.flow.elseif">
                <starts-with>
                    <expression>\b(else\s*if)\s*(\()</expression>
                    <capture number="1" name="keyword.control.flow.elseif" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="container.statement.control.flow.else">
                <expression>\belse\b</expression>
                <capture number="0" name="keyword.control.flow.else" />
            </zone>
            <zone name="container.statement.control.flow.for">
                <starts-with>
                    <expression>\b(for)\s*(\()</expression>
                    <capture number="1" name="keyword.control.flow.for" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
										<zone name="keyword.control.flow.in">
                        <expression>in</expression>
                    </zone>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="container.statement.control.flow.while">
                <starts-with>
                    <expression>\b(while)\s*(\()</expression>
                    <capture number="1" name="keyword.control.flow.while" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="container.statement.control.flow.dowhile">
                    <expression>\bdo\b</expression>
                    <capture number="0" name="keyword.control.flow.dowhile" />
            </zone>
            <zone name="container.statement.control.flow.switch">
                <starts-with>
                    <expression>\b(switch)\s*(\()</expression>
                    <capture number="1" name="keyword.control.flow.switch" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
            <zone name="container.statement.control.exception.try">
                <expression>\btry\b</expression>
                <capture number="0" name="keyword.control.exception.try" />
            </zone>
            <zone name="container.statement.control.exception.finally">
                <expression>\bfinally\b</expression>
                <capture number="0" name="keyword.control.exception.finally" />
            </zone>
            <zone name="container.statement.control.exception.catch">
                <starts-with>
                    <expression>\b(catch)\s*(\()</expression>
                    <capture number="1" name="keyword.control.exception.catch" />
                    <capture number="2" name="delimiter.balanced.parenthesis.begin" />
                </starts-with>
                <ends-with>
                    <expression>\)</expression>
                    <capture number="0" name="delimiter.balanced.parenthesis.end" />
                </ends-with>
                <subzones>
                    <include collection="code.block.subzones" />
                </subzones>
            </zone>
        </collection>
		
		<collection name="code.block.subzones">
				<include collection="metadata.comment" />
	        <include collection="literal.collection" />
	        <include collection="container.block" />
	        <include collection="literal.keyword" />
	        <include collection="delimiter" />
	        <include collection="literal.string" />
	        <include collection="literal.numeric" />
	        <include collection="keyword" />
		</collection>
		
		<!-- Delimiters -->
        
        <collection name="delimiter">
            <zone name="delimiter.terminator">
                <expression>;</expression>
            </zone>
            <zone name="delimiter.separator.comma">
                <expression>,</expression>
            </zone>
            <zone name="delimiter.separator.pairing">
                <expression>\:</expression>
            </zone>
						<zone name="delimiter.separator.dot">
							<expression>\.</expression>
						</zone>
            <zone name="delimiter.balanced.begin.curly-brace">
                <expression>\{</expression>
            </zone>
            <zone name="delimiter.balanced.end.curly-brace">
                <expression>\}</expression>
            </zone>
            <zone name="delimiter.balanced.begin.parenthesis">
                <expression>\(</expression>
            </zone>
            <zone name="delimiter.balanced.end.parenthesis">
                <expression>\)</expression>
            </zone>
            <zone name="delimiter.balanced.begin.square-brace">
                <expression>\[</expression>
            </zone>
            <zone name="delimiter.balanced.end.square-brace">
                <expression>\]</expression>
            </zone>
        </collection>
		
		<collection name="comment">
			<zone name="metadata.comment.documentation">
				<starts-with>
					<expression>/\*\*</expression>
					<capture number="0" name="punctuation.definition.begin"/>
				</starts-with>
				<ends-with>
					<expression>\*/</expression>
					<capture number="0" name="punctuation.definition.end"/>
				</ends-with>
			</zone>
			<zone name="metadata.comment.block">
				<starts-with>
					<expression>/\*</expression>
					<capture number="0" name="punctuation.definition.begin"/>
				</starts-with>
				<ends-with>
					<expression>\*/</expression>
					<capture number="0" name="punctuation.definition.end"/>
				</ends-with>
			</zone>
			<zone name="metadata.comment.line">
				<expression>(//).*$\n?</expression>
				<capture number="1" name="punctuation.definition.begin"/>
			</zone>
		</collection>
		
		<!-- Keywords and standard classes... -->
		
		<collection name="keyword">
			<zone name="keyword.definition">
				<expression>\b(package|class|function|import|interface|extends|implements|var|typedef)</expression>
			</zone>
			<zone name="identifier.type.sys">
				<expression>\b(Array(Access)?|Bool|Class|Date(Tools)?|Dynamic|EReg|Enum|Float|Hash|Int(Hash|Iter)?|Itera(ble|tor)|Lambda|List|Math|Null|Reflect|Std|String(Buf|Tools)?|Type|UInt|ValueType|Void|Xml(Type)?)\b</expression>
			</zone>
			<zone name="identifier.type.sys.flash-pkg">
				<expression>\b(Accessibility|Boot|Button|Camera|Color|ContextMenu(Item)?|ExtendedKey|Key|Lib|LoadVars|LocalConnection|Microphone|Mouse|MovieClip(Loader)?|Net(Connection|Stream)|PrintJob|Selection(Listener)?|SharedObject|Sound|Stage|System|Text(Field|Format|Snapshot)|Video|XML(Request|Socket))\b</expression>
			</zone>
			<zone name="identifier.type.sys.flash9-pkg">
				<expression>\b(Boot|Error|Lib|Memory|Vector)\b</expression>
			</zone>
			<zone name="identifier.type.sys.haxe-pkg">
				<expression>\b(BaseCode|Fast(Cell|List)|Firebug|Http|Int32|Log|Md5|PosInfos|Public|Resource|Serializer|Stack(Item)?|Template|Timer(Queue)?|TypeResolver|Unserializer)\b</expression>
			</zone>
			<zone name="identifier.type.sys.js-pkg">
				<expression>\b(Anchor|Body|Boot|Button|Checkbox|Document|Dom|Event|FileUpload|Form(Element)?|Frame(set)?|Hidden|History|Html(Collection|Dom)|IFrame|Image|Lib|Link|Location|MetaDom|Navigator|Option|Password|Radio|Reset|SWFObject|Screen|Select(ion)?|Style(Sheet)?|Submit|Text(area)?|Window|XML(HttpRequest|Socket))\b</expression>
			</zone>
			<zone name="identifier.type.sys.neko-pkg">
				<expression>\b(Boot|File(Kind|Stat|System)|Lib|Native(Array|String)|Random|Sys|Utf8|Web)\b</expression>
			</zone>
			<zone name="identifier.type.sys.php-pkg">
				<expression>\b(Boot|CacheLimiter|Exception|File(Kind|Stat|System)|HException|Lib|Native(Array|String)|Session|Sys|Utf8|Web)\b</expression>
			</zone>
			<zone name="identifier.package.sys.flash-pkg">
				<expression>\b(flash(?:\.(?:accessibility|display|errors|events|external|filters|geom|media|net|printing|sampler|system|text|trace|ui|utils|xml))?)\b</expression>
			</zone>
			<zone name="identifier.package.sys.haxe-pkg">
				<expression>\b(haxe(?:\.(?:io|remoting|rtti|unit|xml))?)\b</expression>
			</zone>
			<zone name="identifier.package.sys.js-pkg">
				<expression>\bjs\b</expression>
			</zone>
			<zone name="identifier.package.sys.neko-pkg">
				<expression>\bneko(?:\.(?:db|io|net|vm|zip))?\b</expression>
			</zone>
			<zone name="identifier.package.sys.php-pkg">
				<expression>\bphp(?:\.(?:db|io|net))?\b</expression>
			</zone>
			<zone name="identifier.package.sys.tools-pkg">
				<expression>\btools(?:\.(?:haxedoc|haxelib|hxinst))?\b</expression>
			</zone>
			<zone name="keyword.control.flow">
                <expression>\b(break|case|continue|default|do|else|else\s*if|for|if|switch|while|return)\b</expression>
            </zone>
			<zone name="keyword.modifier.scope">
				<expression>\b(public|private)\b</expression>
			</zone>
			<zone name="keyword.modifier.aux">
				<expression>\b(static|dynamic|override|inline)\b</expression>
			</zone>
		</collection>
		
		<collection name="literal.collection">
			<zone name="literal.collection.array">
				<starts-with>
					<expression>\[</expression>
				</starts-with>
				<ends-with>
					<expression>\]</expression>
				</ends-with>
				<subzones>
					<include collection="core" />
				</subzones>
			</zone>
		</collection>
		
		<!-- Literals Grabbed from PHP.sugar (via the AS3 sugar...) -->
	    
	    <collection name="literal.string">
            <zone name="literal.string.single">
                <starts-with>
                    <expression>'</expression>
                    <capture number="0" name="delimiter.balanced.quote.begin"/>
                </starts-with>
                <ends-with>
                    <expression>'</expression>
                    <capture number="0" name="delimiter.balanced.quote.end"/>
                </ends-with>
                <subzones>
                    <zone name="literal.escape.brief">
                        <!-- 'A single-quoted string with \'escape sequences\'' -->
                        <expression>(\\)('|\\)</expression>
                        <capture number="1" name="delimiter.seperator.escape"/>
                        <capture number="2" name="literal.character"/>
                    </zone>
                </subzones>
            </zone>
            <zone name="literal.string.double">
                <starts-with>
                    <expression>"</expression>
                    <capture number="0" name="delimiter.balanced.double-quote.begin"/>
                </starts-with>
                <ends-with>
                    <expression>"</expression>
                    <capture number="0" name="delimiter.balanced.double-quote.end"/>
                </ends-with>
                <subzones>
                    <zone name="literal.escape.brief">
                        <!-- 'A single-quoted string with \'escape sequences\'' -->
                        <expression>(\\)("|\\)</expression>
                        <capture number="1" name="delimiter.seperator.escape"/>
                        <capture number="2" name="literal.character"/>
                    </zone>
                </subzones>
            </zone>
	    </collection>
	    
        <collection name="literal.numeric">
            <!--
            I want to seperately hilight all the different types of
            literal.numerics. So, we have to provide multiple similar definitions
            of a literal.numeric.
            
			Grabbed from PHP Sugar
            Grabbed from elliottcable's Ruby.sugar
            -->
            <!-- 01756 -->
            <zone name="literal.numeric.integer.octal">
                <expression>\b(0)([0-7]+)\b</expression>
            </zone>
            <!-- 0b010010110 -->
            <zone name="literal.numeric.integer.binary">
                <expression>\b(0(?:b|B))([01]+)\b</expression>
            </zone>
            <!-- 0xDEADBEEF586 -->
            <zone name="literal.numeric.integer.hex">
                <expression>\b(0(?:x|X))([0-9a-fA-F]+)\b</expression>
            </zone>
            <!-- 142.87e3, 0.22e8 -->
            <zone name="literal.numeric.float.with-exponent">
                <expression>\b(0|[1-9][0-9]*)(\.)([0-9]+)(e|E)(-?[0-9]+)\b</expression>
            </zone>
            <!-- 142.87, 0.22 -->
            <zone name="literal.numeric.float">
                <expression>\b(0|[1-9][0-9]*)(\.)([0-9]+)\b</expression>
            </zone>
            <!-- 142e3, 0e8 -->
            <zone name="literal.numeric.integer.decimal.with-exponent">
                <expression>\b(0|[1-9][0-9]*)(e|E)(-?[0-9]+)\b</expression>
            </zone>
            <!-- 142e3, 0e8 -->
            <zone name="literal.numeric.integer.decimal">
                <expression>\b(0|[1-9][0-9]*)\b</expression>
            </zone>
        </collection>
        
        <collection name="literal.keyword">
            <!-- true -->
            <zone name="literal.keyword.bool.true">
            	<expression>\btrue\b</expression>
            </zone>
            <!-- false -->
            <zone name="literal.keyword.bool.false">
            	<expression>\bfalse\b</expression>
            </zone>
            <!-- null -->
            <zone name="literal.keyword.nothing">
            	<expression>\bnull\b</expression>
            </zone>
        </collection>

		<!-- Metadata grabbed from PHP.sugar, but modified to handle #ifdef's -->
		<collection name="metadata.comment">
			<!-- // comment -->
			<zone name="metadata.comment.line.double-slash">
				<expression>(//)(\s?(.*)?$\n?)</expression>
				<capture number="1" name="delimiter.separator.double-slash.comment.begin" />
				<capture number="3" name="content" />
			</zone>
			
			<zone name="metadata.comment.documentation">
				<starts-with>
					<expression>(/\*\*)(\**)</expression>
					<capture number="1" name="delimiter.separator.slash.double-asterisk.comment.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\**)(\*/)</expression>
					<capture number="2" name="delimiter.separator.slash.single-asterisk.comment.end"/>
				</ends-with>
				<subzones>
					<zone name="metadata.comment.documentation.line">
						<starts-with>
							<expression>(\*)</expression>
							<capture number="1" name="delimiter.separator.asterisk" />
						</starts-with>
						<ends-with>
							<expression>$\n?</expression>
						</ends-with>
						<subzones>
							<zone name="metadata.comment.documentation.content">
								<expression>(.*)?</expression>
								<capture number="3" name="content" />
							</zone>
						</subzones>
					</zone>
				</subzones>
			</zone>			

			<zone name="metadata.comment.block">
				<starts-with>
					<expression>(/\*)</expression>
					<capture number="1" name="delimiter.separator.slash.single-asterisk.comment.begin"/>
				</starts-with>
				<ends-with>
					<expression>(\*/)</expression>
					<capture number="1" name="delimiter.separator.slash.single-asterisk.comment.end"/>
				</ends-with>
			</zone>
		</collection>
			
		<collection name="metadata.preprocess">	
			<zone name="metadata.preprocess.if">
				<starts-with>
					<expression>^(?:(#(?:else)?if)\s+([^\s]+))|(#else)\b</expression>
					<capture number="1" name="keyword.preprocess.if" />
					<capture number="2" name="metadata.preprocess.cond" />
					<capture number="3" name="keyword.preprocess.else" />
				</starts-with>
				<ends-with>
					<expression>^(?:(#else(?:if)?)|(#end))\b</expression>
					<capture number="1" name="keyword.preprocess.else" />
					<capture number="2" name="keyword.preprocess.end" />
				</ends-with>
				<subzones>
					<include syntax="self" />
				</subzones>
			</zone>
			
	    </collection>
		
	</library>
</syntax>